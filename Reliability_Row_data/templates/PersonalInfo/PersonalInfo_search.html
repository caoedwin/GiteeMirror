{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}perIn_search{% endblock %}
{% block css %}
<link rel="stylesheet" href="/static/css/index.css">
<style>
label{
    color:white;
}
 .selectMsg{
     font-size:16px;
      padding: 15px;
      display: flex;
      flex-wrap: wrap;
  }
  .selectMsg label{
      font-weight: 800;
      margin-right: 10px;
      color:aliceblue;
  }
  .customerContent,.departmentContent,.lessonContent,.groupemployeesContent{
     margin-left: 20px;
}

.inputError{
    text-align: center;
    color: crimson;
    background-color: beige;
    width: 50%;
    margin: 10px auto 5px;
    position: relative;
}
  .inputError:before{
    display:block;
    content:'';
    border-width:8px 8px 8px 8px;
    border-style:solid;
    border-color:transparent transparent beige transparent;

    /* 定位 */
    position:absolute;
    left:50%;
    top:-16px;
}
 .selectItem{
    font-size: 20px;
    font-weight: bold;
    color: aliceblue;
}
  .tableAround{
    padding: 20px;
    -moz-box-shadow: 0px 0px 10px #333333;
    -webkit-box-shadow: 0px 0px 10px #333333;
    box-shadow: 0px 0px 10px #333333;
    border-radius: 10px;
    background-color: rgba(255,255,255,0.1);
}
.demo-fit{
   display:inline-block;
   vertical-align: top;
   width:123px;
   height:186px;
   border:1px solid black;

}
.cardInformation{
   display:inline-block;!important
   margin-left:20px;
}
.cardInformation label{
   margin-bottom: -25px;
}
.cardInformation tr td{
   width: 300px;
}
tbody tr td:last-child {
   text-align:left;
}
.el-pagination__total,.el-pagination__jump{
        color:white;
}
.el-table .my-cell {
    vertical-align: top
  }
#sh {
        font-size:18px;
           font-family:微软雅黑;
        border: 2px solid #9f9ca1;
    }
#sh::-webkit-input-placeholder{
        color:#2f97a8;
    font-family:微软雅黑;
}
#sh::-moz-placeholder{
        color:#2f97a8;
    font-family:微软雅黑;
}
#sh:-ms-input-placeholder{
        color:#2f97a8;
    font-family:微软雅黑;
    }
</style>

{% endblock %}
{% block content %}
<div id="app">
      <!--搜索框-->
    <div class="selectMsg" >
           <div class="yearContent">
                 <label for="year">年份: </label>
                 <el-date-picker ref="Year" value-format="yyyy" v-model="year" type="year" placeholder="選擇年份" style="height:40px;width:100px;border-radius:5px 5px 5px 5px;"></el-date-picker>
           </div>
           <div class="customerContent">
                 <label for="customer">客戶別: </label>
                 <select  ref="Customer"  @change="changeCustomer" v-model="customer" style="height:40px;width:100px;border-radius:5px 5px 5px 5px;">
                       <option value="All">All</option>
                       <option v-for="(item,key,index) in customerOptions" >${ key }</option>
                 </select>
{#                 <div class="inputError" v-cloak v-show="customerError">不能為空</div>#}
           </div>
           <div class="departmentContent">
                  <label for="department">部門:</label>
                  <select  ref="Department"  @change="changeDepartment" v-model="department" style="height:40px;border-radius:5px 5px 5px 5px;width:100px;">
                       <option value="All">All</option>
                       <option v-for="(item,key,index) in departmentOptions">${ item.Department }</option>
                  </select>
{#                  <div class="inputError" v-cloak  v-show="departmentError">不能為空</div>#}
           </div>
           <div class="lessonContent">
                  <label for="lesson">課别:</label>
                  <select  ref="Lesson"  v-model="lesson" style="height:40px;border-radius:5px 5px 5px 5px;width:120px;">
                       <option value="All">All</option>
                       <option v-for="(item,key,index) in lessonOptions">${ key }</option>
                  </select>
{#                  <div class="inputError" v-cloak  v-show="lessonError">不能為空</div>#}
           </div>
           <div class="groupemployeesContent">
                 <label for="groupemployees">集團員工: </label>
                   <el-autocomplete
                      ref="GroupEmployees"
                      class="inline-input"
                      v-model="groupemployees"
                      :fetch-suggestions="querySearch"
                      placeholder="请输入内容"
                      @select="handleSelect"
                 ></el-autocomplete>
{#                 <select  ref="GroupEmployees"   v-model="groupemployees" style="height:40px;border-radius:5px 5px 5px 5px;width:100px;">#}
{#                       <option value="All">All</option>#}
{#                       <option v-for="(item,key,index) in groupemployeesOptions">${ item.GroupEmployees }</option>#}
{#                 </select>#}
{#                 <div class="inputError" v-cloak v-show="groupemployeesError">不能為空</div>#}
           </div>
                 <el-button @click="find" v-cloak type="primary" style="height:40px;margin-left: 20px">搜索</el-button>
                 <el-button @click="exportExcel" type="success" v-if="canExport==0" style="height:40px;margin-left: 20px">導出</el-button>
        <br/>
       <el-input type="text" v-model="search" id="sh" placeholder="請輸入關鍵字搜索..."></el-input>
    </div>
    <div class="tableAround" v-cloak >
    <span  class="selectItem" v-cloak  v-if="showCustomer&&showDepartment&&showLesson">當前表格信息：${ showYear }/${ showCustomer }/${ showDepartment }/${ showLesson }/${ showGroupEmployees } </span>
    <el-table height="700" border :data="datas.slice((currentPage-1)*pageSize,currentPage*pageSize)"  style="min-width: 100%;border-radius: 10px" id="out-table" @row-click="selectDetail" :header-cell-style="{'background-color':'#fafafa','font-weight':'800','border-bottom':'1px solid rgb(103, 194, 58)'}">
              <el-table-column type="index" :index="indexMethod" ></el-table-column>
                <el-table-column  prop="Customer" label="客戶"  ></el-table-column>
                <el-table-column  prop="Department" label="部門"  ></el-table-column>
                <el-table-column  prop="Lesson" label="課別"  ></el-table-column>
                <el-table-column  prop="GroupEmployees" label="集團員工"  ></el-table-column>
                <el-table-column  prop="SAPEmployees" label="SAP員工"  ></el-table-column>
                <el-table-column  prop="ChineseName" label="中文姓名"  ></el-table-column>
                <el-table-column  prop="EnglishName" label="英文姓名"  ></el-table-column>
                <el-table-column  prop="Gender" label="性別"  ></el-table-column>
                <el-table-column  prop="Status" label="狀態"  ></el-table-column>
                <el-table-column  prop="RegistrationDate" label="報到日期"  ></el-table-column>
                <el-table-column  prop="DepartureDate" label="離職日期"  ></el-table-column>
                <el-table-column  prop="ExpectedDepartureDate" label="预计離職日期"  ></el-table-column>
                <el-table-column  prop="DepartureReasons" label="離職原因"  ></el-table-column>
                <el-table-column  prop="DepartureDetails" label="離職详情"  ></el-table-column>
{#                <el-table-column  prop="DepartureTo" label="離職去向"  ></el-table-column>#}
{#                <el-table-column  prop="NewCompanyName" label="新公司名稱"  ></el-table-column>#}
{#                <el-table-column  prop="Salary" label="薪資"  ></el-table-column>#}
                <el-table-column  prop="Seniority" label="年資"  ></el-table-column>
                <el-table-column  prop="CurrentTitle" label="現職稱"  ></el-table-column>
                <el-table-column  prop="LastPromotionDate" label="最近一次晉升日期"  ></el-table-column>
{#                <el-table-column  prop="EntryTitle" label="入職職稱"  ></el-table-column>#}
{#                <el-table-column  prop="PromotionNumber" label="晉升次數"  ></el-table-column>#}
{#                <el-table-column  prop="WorkExperience" label="是否承認工作經驗"  ></el-table-column>#}
                <el-table-column  prop="GraduationYear" label="畢業年度"  ></el-table-column>
                <el-table-column  prop="Education" label="學歷"  ></el-table-column>
                <el-table-column  prop="School" label="學校"  ></el-table-column>
{#                <el-table-column  prop="ProfessionAttribution" label="專業歸屬"  ></el-table-column>#}
                <el-table-column  prop="Profession" label="專業"  ></el-table-column>
                <el-table-column  prop="English" label="英語"  ></el-table-column>
                <el-table-column  prop="IdNumber" label="身份証號"  ></el-table-column>
                <el-table-column  prop="Birthday" label="生日"  ></el-table-column>
                <el-table-column  prop="NativeProvince" label="籍貫省份"  ></el-table-column>
                <el-table-column  prop="NativeCity" label="籍貫縣市"  ></el-table-column>
                <el-table-column  prop="HukouProvinces" label="戶口省份"  ></el-table-column>
                <el-table-column  prop="HukouCity" label="戶口縣市"  ></el-table-column>
                <el-table-column  prop="PhoneNumber" label="手機號碼"  ></el-table-column>
    </el-table>
        <div class="block">
                <el-pagination  @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page="currentPage" :page-sizes="[10, 50, 100, 200]" :page-size="100" layout="total, sizes, prev, pager, next, jumper" :total="total_computed">
                </el-pagination>
        </div>
  </div>

  <el-dialog :visible.sync="detail" align="center">
        <template>
          <div class="demo-fit">
              <image :src="Imageurl" alt="暫無頭像" mode="scaleToFill" width="123px" height="186px"/>
          </div>
      <div class="cardInformation">
        <el-form  inline-block >
            <table border="1" height="15" width="500" >
                <tr>
                    <td><el-form-item label="SAP編號:"></el-form-item></td>
                    <td><span>${ form.SAPEmployees }</span></td>
                    <td><el-form-item label="姓名:"></el-form-item></td>
                    <td><span>${ form.ChineseName }</span></td>
                </tr>
                <tr>
                    <td><el-form-item label="工號:"></el-form-item></td>
                    <td><span>${ form.GroupEmployees }</span></td>
                    <td><el-form-item label="英文名字:"></el-form-item></td>
                    <td><span>${ form.EnglishName }</span></td>
                </tr>
                <tr>
                    <td><el-form-item label="所學專業:"></el-form-item></td>
                    <td  colspan="3"> <span>${ form.Profession }</span></td>
                </tr>
                <tr>
                    <td><el-form-item label="畢業學校:"></el-form-item></td>
                    <td  colspan="3"> <span>${ form.School }</span></td>
                </tr>
                <tr>
                    <td><el-form-item label="學歷:"></el-form-item></td>
                    <td><span>${ form.Education }</span></td>
                    <td><el-form-item label="職稱:"></el-form-item></td>
                    <td><span>${ form.CurrentTitle }</span></td>
                </tr>
                <tr>
                    <td><el-form-item label="籍貫:"></el-form-item></td>
                    <td><span>${ form.NativeProvinceCity }</span></td>
                    <td><el-form-item label="出生年月:"></el-form-item></td>
                    <td><span>${ form.Birthday }</span></td>
                </tr>
                <tr>
                    <td><el-form-item label="報到日期:"></el-form-item></td>
                    <td><span>${ form.RegistrationDate }</span></td>
                    <td><el-form-item label="部門代碼:"></el-form-item></td>
                    <td><span>${ form.Department }</span></td>
                </tr>
                <tr>
                    <td><el-form-item label="人員狀態:"></el-form-item></td>
                    <td><span>${ form.Status }</span></td>
                    <td><el-form-item label="離職日期:"></el-form-item></td>
                    <td><span>${ form.ExpectedDepartureDate }</span></td>
                </tr>
            </table>
        </el-form>
       </div>
{#            由於每次更新都是年初excel整體上傳，而不是在系統中編輯，故而系統中沒有歷史記錄，就無法算出晉升次數以及每次晉升日期，故決定拿掉這部分信息#}
       {% comment %}<el-table  border :data="tableData">
                <el-table-column type="index" :index="indexMethod" ></el-table-column>
                <el-table-column  prop="Department" label="部門代碼"  width="130"></el-table-column>
                <el-table-column  prop="GroupEmployees" label="工號"  width="100"></el-table-column>
                <el-table-column  prop="ChineseName" label="姓名"  ></el-table-column>
                <el-table-column  prop="EntryTitle" label="原職稱"  ></el-table-column>
                <el-table-column  prop="CurrentTitle" label="現職稱"  ></el-table-column>
                <el-table-column  prop="PromotionDate" label="晉升日期"    width="120"></el-table-column>
                <el-table-column  prop="Intervaltime" label="間隔時間（年）"></el-table-column>
                <el-table-column  prop="beizhu" label=" "  ></el-table-column>
       </el-table>{% endcomment %}
         </template>
  </el-dialog>
</div>
{% endblock %}
{% block scripts %}
<script src="/static/js/es6/polyfill.min.js"></script>
<script src="/static/js/es6/babel.min.js"></script>
<script src="/static/js/axios.min.js"></script>
<script src="/static/js/vue.min.js"></script>
<script src="/static/js/qs.js"></script>
<script src="/static/js/Element/index.js"></script>
<script src="/static/js/xlsx/FileSaver.min.js"></script>
    <script type="text/babel">
    new Vue({
        el: '#app',
        delimiters: ['${', '}'],
        data: function () {
            return {
                // 搜索条件
                year:'',
                yearOptions:[],
                GroupEmployeesNum:[],
                customer:'',
                customerOptions:{},
                customerError:false,
                department:'',
                departmentOptions:[],
                departmentError:false,
                lesson:'',
                lessonOptions:{},
                lessonError:false,
                groupemployees:'',
                groupemployeesOptions:[],
                groupemployeesError:false,
                tableContent:[],
                //表格信息顯示
                showYear:'',
                showCustomer:'',
                showDepartment:'',
                showLesson:'',
                showGroupEmployees:'',

                detail:false,
                form:{},
                tableData:[],
                Imageurl:'',

                canExport:null,//導出權限

                currentPage: 1,//默认显示第一页
                pageSize:100,//默认每页显示100条
                totalNum: null,

                search:'',
                Totalsize:null,
                }
        },
        mounted(){        // 页面渲染后触发该区域内容 即页面初始化
            this.getdata("first");
        },
        methods: {
            indexMethod(index) {
                  return index +1;
            },
            //获取数据
            getdata: function (e) {
                let data = {"isGetData": e, "csrfmiddlewaretoken": $("[name='csrfmiddlewaretoken']").val()};
                axios.post("/PersonalInfo/PersonalInfo-search/", Qs.stringify(data), {
                    headers: {'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'}
                }).then((res) => {
                    this.tableContent=res.data.content;
                    this.customerOptions=res.data.select;
                    this.canExport=res.data.canExport;
                    this.GroupEmployeesNum=res.data.GroupEmployeesNum;

                 });
            },

            querySearch(queryString,cb) {
            var GroupEmployeesNum = this.GroupEmployeesNum;
            var results = queryString ? GroupEmployeesNum.filter(this.createFilter(queryString)) : GroupEmployeesNum;
            // 调用 callback 返回建议列表的数据
            cb(results);
              },
            createFilter(queryString) {
                    {#console.log(queryString,'p2');#}
                return (restaurant) => {
                  return (
                      {#console.log(restaurant),#}
                      restaurant.value.toLowerCase().indexOf(queryString.toLowerCase()) === 0);
                };
            },
            handleSelect(item) {
                //console.log(item);
            },

             //级联
            changeCustomer:function () {
                 if(this.$refs.Customer.value ==""){
                      this.departmentOptions=[""];
                      return false;
                 }
                 this.departmentOptions=this.customerOptions[this.$refs.Customer.value];
                 this.department="";
                 console.log(this.departmentOptions);
             },
            changeDepartment:function(index){
                if(this.$refs.Department.value ==""){
                      this.lessonOptions=[""];
                      return false;
                 }
                let Customer=this.$refs.Customer.value;
                let Department=this.$refs.Department.value;
                let data ={"isGetData":"JiLian","Customer":Customer,"Department":Department,"csrfmiddlewaretoken":$("[name='csrfmiddlewaretoken']").val()}
               axios.post("/PersonalInfo/PersonalInfo-search/",Qs.stringify(data), {
               headers:{ 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'}
                }).then((res) => {
                    this.lessonOptions=res.data.lessonOptions;
                });
            },
            //changeLesson:function(index){
            //    if(this.$refs.Lesson.value ==""){
            //         this.groupemployeesOptions=[""];
            //         return false;
            //    }
            //      this.groupemployeesOptions=this.lessonOptions[this.$refs.Lesson.value];
            //     this.groupemployees="";
            //     console.log(this.groupemployeesOptions);
            //},
            //上传搜索项：以此选项搜索符合条件的内容
            find :function(){
                {% comment %}
                if(this.$refs.Customer.value ==""){
                      this.customerError= true;
                      return false;
                 }
                if(this.$refs.Department.value ==""){
                      this.departmentError= true;
                      return false;
                 }
                if(this.$refs.Lesson.value ==""){
                      this.lessonError= true;
                      return false;
                 }

                if(this.$refs.GroupEmployees.value ==""){
                      this.groupemployeesError= true;
                      return false;
                 }
                 {% endcomment %}
                let Year=this.$refs.Year.value;
                let Customer = this.$refs.Customer.value;
                let Department=this.$refs.Department.value;
                let Lesson = this.$refs.Lesson.value;
                let GroupEmployees = this.$refs.GroupEmployees.value;
               let data ={"isGetData":"SEARCH","Year":Year,"Customer":Customer,"Department":Department,"Lesson":Lesson,"GroupEmployees":GroupEmployees,"csrfmiddlewaretoken":$("[name='csrfmiddlewaretoken']").val()}
               axios.post("/PersonalInfo/PersonalInfo-search/",Qs.stringify(data), {
               headers:{ 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'}
                }).then((res) => {
                  this.tableContent=res.data.content;
                  this.totalNum=this.tableContent.length;
                })
                       this.showYear=Year;
                       this.showCustomer=Customer;
                       this.showDepartment=Department;
                       this.showLesson=Lesson;
                       this.showGroupEmployees=GroupEmployees;
                       this.customerError= false;
                       this.departmentError= false;
                       this.lessonError= false;
                       this.groupemployeesError= false;

             },
            //導出表格
            exportExcel:function (){
           /* 从表生成工作簿对象 */

        {% comment %}
         if(this.$refs.Customer.value ==""){
                      this.customerError= true;
                      return false;
                 }
                if(this.$refs.Department.value ==""){
                      this.departmentError= true;
                      return false;
                 }
                if(this.$refs.Lesson.value ==""){
                      this.lessonError= true;
                      return false;
                 }
                if(this.$refs.GroupEmployees.value ==""){
                      this.groupemployeesError= true;
                      return false;
                 }
             {% endcomment %}
                let temp=[];
                 temp.push(Number(this.currentPage));
                 temp.push(Number(this.pageSize));
                 console.log(temp)
                 this.currentPage=1;
                 this.pageSize=this.tableContent.length;
                 console.log(temp,this.defaultPage1,this.pageSize);
                 setTimeout(() => { let table = document.querySelector("#out-table").cloneNode(true);
                 // 因为element-ui的表格的fixed属性导致多出一个table，会下载重复内容，这里删除掉
                 //table.removeChild(table.querySelector(".el-table__fixed"))
                 //table.removeChild(table.querySelector(".el-table__fixed-right"))//左右都有固定列
                    //let wb = XLSX.utils.table_to_book(table,{raw:true});//mytable为表格的id名

                var wb = XLSX.utils.table_to_book(table,{raw:true});
                console.log("wb",wb);
                /* 获取二进制字符串作为输出 */
                var wbout = XLSX.write(wb, {
                    bookType: "xlsx",
                    bookSST: true,
                    type: "array"
                });
                console.log("wbout",wbout);
                try {
                    saveAs(
                    //Blob 对象表示一个不可变、原始数据的类文件对象。
                    //Blob 表示的不一定是JavaScript原生格式的数据。
                    //File 接口基于Blob，继承了 blob 的功能并将其扩展使其支持用户系统上的文件。
                    //返回一个新创建的 Blob 对象，其内容由参数中给定的数组串联组成。
                    new Blob([wbout], { type: "application/octet-stream" }),
                    //设置导出文件名称
                    "sheetjs.xlsx"
                    );

                } catch (e) {
                    if (typeof console !== "undefined") console.log(e, wbout);
                }
                this.currentPage=temp[0];
                    this.pageSize=temp[1];//edwin:要想导出后回到当前页而不是第一页，<el-pagination里面的:page-size="100"，而不能是:page-size="pageSize"
                    //console.log(this.currentPage,this.pageSize)
                    temp=[];
                return wbout;},1000) ;
                },
              test:function (row) {
                  console.log("trt");
            },
            selectDetail:function(row){
                this.detail=true;
                this.form={};//防止报错的话显示上一个人的信息
               let data ={"isGetData":"selectDetail","Year":this.showYear,"Customer":this.showCustomer,"Department":this.showDepartment,"Lesson":this.showLesson,"GroupEmployees":this.showGroupEmployees,"ID":row.id,"GroupEmployees":row.GroupEmployees,"csrfmiddlewaretoken":$("[name='csrfmiddlewaretoken']").val()}
               axios.post("/PersonalInfo/PersonalInfo-search/",Qs.stringify(data), {
               headers:{ 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'}
                }).then((res) => {
                  this.form=res.data.form;
                  {#console.log(this.form)#}
                  this.tableData=res.data.tableData;
                  this.Imageurl=res.data.Imageurl;
                })
            },
            handleSizeChange(val) {
            console.log(`每页 ${val} 条`);
                    this.pageSize = val;
            },
            handleCurrentChange(val) {
                console.log(`当前页: ${val}`);
                  this.currentPage = val;
                  console.log(this.tableContent.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize));
            },

             },
        computed:{
                datas(){//必须是el-table里面绑定的数据变量,不能与axios接受的变量名一样
                    //console.log(111)
                    const search=this.search;
                    if(search){
                        return this.tableContent.filter(data=>{//axios返回时接受数据的变量
                            return Object.keys(data).some(key=>{
                                return String(data[key]).toLowerCase().indexOf(search.toLowerCase())>-1
                            })
                        })
                    }
                    return this.tableContent//axios返回时接受数据的变量
                },
                total_computed () {
                    this.Totalsize = this.datas.length;//edwin:export数据的个数
                    console.log(this.Totalsize);
                  return this.datas.length//必须是el-table里面绑定的数据变量
                }
            },
    })
    </script>
{% endblock %}










{% comment %}
{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}MQM_search{% endblock %}
{% block css %}
<link rel="stylesheet" href="/static/css/index.css">
    <style>
.content{
    width:25px;
    height: 70px;
    position: fixed;
    right: 10px;
    top:60px;
    background-color:#343957;
    color:white;
    font-size: 20px;
    text-align: center;
    margin: 0 auto;
    word-wrap: break-word;
    line-height: 24px;
    writing-mode: vertical-lr;
    z-index: 99;
    opacity: 0.9;
}
    #container-yansebiaoshi{
    display:none;
    position: fixed;
    right: 35px;
    top:60px;
    z-index: 99;
    border: 2px solid  #deb887;
}
    .el-pagination__total,.el-pagination__jump{
        color:white;
    }
    .el-table td.is-right, .el-table th.is-right {
    white-space: pre-line;
    text-align: left;
}
    .el-table .cell{
        white-space: pre-line;
    }
    .gutter{
        display:block!important;
        width:17px!important;
    }
    内容过长显示省略号
    .oneLine {
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    提示框宽度，提示内容换行
    .el-tooltip__popper{
    max-width: 400px;
    white-space: pre-line;
    }
    </style>
{% endblock %}
{% block content %}
     <div class="content" id="yincang">spec</div>
    <div id="container-yansebiaoshi">
    <img src="/static/images/spec.png">
    </div>
<div id="app">
<div class="row" style="white-space: nowrap;">
                    <div class="col-md-3">
                    <label style="color: #FFF" for="Customer">Customer</label>
           <select id="Customer" ref="Customer"  @change="changeCustomer" v-model="selectedCustomer" style="height:30px;width:100px;border-radius:5px 5px 5px 5px;">
               <option value="">All</option>
               <option v-for="(item,key,index) in selectItem" >${ key }</option>
           </select>
                    </div>
                    <div class="col-md-2">
                        　<label style="color: #FFF" for="Project">Project</label>
           <select id="Project" ref="Project"   v-model="selectedProject" style="height:30px;border-radius:5px 5px 5px 5px;width:100px;">
               <option value="">All</option>
               <option v-for="(item,key,index) in selectProject">${ item.Project }</option>
           </select>
                    </div>
          <div class="col-md-2">
                        　　<label style="color: #FFF" for="Category">Category</label>
             <select id="Category" ref="Category"  v-model="selectedCategory" style="height:30px;border-radius:5px 5px 5px 5px;width:70px;">
               <option value="">All</option>
               <option v-for="(item,key,index) in selectCategory">${ item.Category }</option>
           </select>
                    </div>
                    <div class="col-md-1">
                        <el-button size="small" style="background:#428bca;color:#fff;" value="Search" name="Search" @click="selectMsg">Search</el-button>
                    </div>
                    <div class="col-md-1">
                        <el-button size="small" @click="exportExcel" type="info" >Export</el-button>
                    </div>
          </div>
<template>
<el-input type="text" v-model="search"  placeholder="Search..."></el-input>
   <el-table id="out-table" border height="750" @sort-change='sortChange' :default-sort = "{prop: 'CompalPN', order: 'ascending'}" :data="datas_computed.slice((currentPage-1)*pageSize,currentPage*pageSize)" tooltip-effect="dark" style="width: 100%"
   :cell-style="addClass">
    <el-table-column type="index" :index="indexMethod" fixed></el-table-column>
       <el-table-column prop="Project" label="Project" align="center" width="120" sortable='custom' fixed></el-table-column>
       <el-table-column prop="Category" label="Category" align="center" width="156" sortable='custom' fixed></el-table-column>
       <el-table-column prop="Name" label="Name" align="center" width="156" sortable='custom' fixed></el-table-column>
    <el-table-column prop="Vendor" label="Vendor" align="center" sortable='custom' fixed></el-table-column>
       <el-table-column label="B for DQA" align="center">
       <el-table-column prop="DataCodeB" label="D/C" width="100" align="center" sortable='custom'></el-table-column>
       <el-table-column prop="ResultforB" label="Result" width="100" align="center" sortable='custom'>
           <template slot-scope="scope">
                  <el-tooltip v-if="scope.row.Comments" class="item" effect="dark" placement="top">
                            <div v-html="ToBreak(scope.row.Comments)" slot="content"></div>
                            <div class="oneLine">${ scope.row.ResultforB }</div>
                        </el-tooltip>
                   <span v-else="scope.row.Comments">${ scope.row.ResultforB }</span>
              </template>
       </el-table-column>
       <el-table-column prop="ReliabilityB" label="Rel." width="100" align="center" sortable='custom'></el-table-column>
       <el-table-column prop="CompatibilityB" label="Com." width="110"  align="center" sortable='custom'></el-table-column>

    </el-table-column>
{#    <el-table-column label="B for RD" align="center">#}
{#       <el-table-column prop="ESDB" label="ESD" width="50"  align="center" show-overflow-tooltip></el-table-column>#}
{#       <el-table-column prop="EMIB" label="EMI" width="50"  align="center" show-overflow-tooltip></el-table-column>#}
{#       <el-table-column prop="RFB" label="RF" width="50"  align="center" show-overflow-tooltip></el-table-column>#}
{#    </el-table-column>#}
       <el-table-column label="C for DQA" align="center">
       <el-table-column prop="DataCodeC" label="D/C" width="100" align="center" sortable='custom'></el-table-column>
       <el-table-column prop="ResultforC" label="Result" width="100" align="center" sortable='custom'>
           <template slot-scope="scope">
                  <el-tooltip v-if="scope.row.Comments" class="item" effect="dark" placement="top">
                            <div v-html="ToBreak(scope.row.Comments)" slot="content"></div>
                            <div class="oneLine">${ scope.row.ResultforC }</div>
                        </el-tooltip>
                   <span v-else="scope.row.Comments">${ scope.row.ResultforC }</span>
              </template>
       </el-table-column>
       <el-table-column prop="ReliabilityC" label="Rel." width="100" align="center" sortable='custom'></el-table-column>
       <el-table-column prop="CompatibilityC" label="Comp." width="110"  align="center" sortable='custom'></el-table-column>
    </el-table-column>
{#    <el-table-column label="C for RD" align="center">#}
{#       <el-table-column prop="ESDC" label="ESD" width="50"  align="center" show-overflow-tooltip></el-table-column>#}
{#       <el-table-column prop="EMIC" label="EMI" width="50"  align="center" show-overflow-tooltip></el-table-column>#}
{#       <el-table-column prop="RFC" label="RF" width="50"  align="center" show-overflow-tooltip></el-table-column>#}
{#    </el-table-column>#}
       <el-table-column label="INV for DQA" align="center">
       <el-table-column prop="DataCodeINV" label="Data Code" width="100" align="center" sortable='custom'></el-table-column>
       <el-table-column prop="ResultforINV" label="Result for INV" width="110" align="center" sortable='custom'>
           <template slot-scope="scope">
                  <el-tooltip v-if="scope.row.Comments" class="item" effect="dark" placement="top">
                            <div v-html="ToBreak(scope.row.Comments)" slot="content"></div>
                            <div class="oneLine">${ scope.row.ResultforINV }</div>
                        </el-tooltip>
                   <span v-else="scope.row.Comments">${ scope.row.ResultforINV }</span>
              </template>
       </el-table-column>
       <el-table-column prop="ReliabilityINV" label="Reliability" width="100" align="center" sortable='custom'></el-table-column>
       <el-table-column prop="CompatibilityINV" label="Compatibility" width="110"  align="center" sortable='custom'></el-table-column>
    </el-table-column>
{#    <el-table-column label="INV for RD" align="center">#}
{#       <el-table-column prop="ESDINV" label="ESD" width="50"  align="center" show-overflow-tooltip></el-table-column>#}
{#       <el-table-column prop="EMIINV" label="EMI" width="50"  align="center" show-overflow-tooltip></el-table-column>#}
{#       <el-table-column prop="RFINV" label="RF" width="50"  align="center" show-overflow-tooltip></el-table-column>#}
{#    </el-table-column>#}
    <el-table-column prop="Controlrun" label="Control run" width="100" align="center" sortable='custom'></el-table-column>
    <el-table-column prop="SourcePriority" label="SP" width="40" align="center" sortable='custom'></el-table-column>
    <el-table-column prop="CompalPN" label="Compal P/N" align="center" width="113" sortable='custom'></el-table-column>
    <el-table-column prop="Status" label="Status" align="center" sortable='custom'></el-table-column>
    <el-table-column prop="VendorPN" label="VendorP/N" align="center" width="100" sortable='custom'></el-table-column>
    <el-table-column prop="Description" label="Description"  align="center" width="204" sortable='custom'></el-table-column>
    <el-table-column prop="Qty" label="Qty"  align="center" sortable='custom'></el-table-column>
    <el-table-column prop="Location" label="Location"  align="center" width="126" sortable='custom'></el-table-column>
    <el-table-column id="st" prop="Comments" label="Comments" width="500" align="right" style="white-space: pre-line;" sortable='custom'></el-table-column>
   </el-table>
    <div class="block">
    <el-pagination  @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page="currentPage" :page-sizes="[10, 50, 100, 200]" :page-size="100" layout="total, sizes, prev, pager, next, jumper" :total="total_computed">
    </el-pagination>
  </div>
</template>
</div>
{% endblock %}
{% block scripts %}
<script src="/static/js/es6/polyfill.min.js"></script>
<script src="/static/js/es6/babel.min.js"></script>
<script src="/static/js/axios.min.js"></script>
<script src="/static/js/vue.min.js"></script>
<script src="/static/js/qs.js"></script>
<script src="/static/js/Element/index.js"></script>
    <script src="/static/js/xlsx/FileSaver.min.js"></script>
<script type="text/babel">
$(document).ready(function() {
    $("#yincang").click(function () {
        $("#container-yansebiaoshi").toggle();
    });
    $("body").click(function (e) {
    if (!$(e.target).closest("#yincang").length) {
        $("#container-yansebiaoshi").hide();
    }
    });
})
new Vue({
    el:'#app',
    delimiters: ['${', '}'],
    data: function () {
            return {
                visible: false,
                tableContent: [],
                selectedCustomer:null,
                selectedProject:null,
                selectCategory:[],
                selectedCategory:null,
                {#selectedLocation:null,#}
                {#selectLocation:null,#}
                {#selectedCompalPN:null,#}
                {#selectCompalPN:null,#}
                selectProject:[],
                selectItem:{},
                selectId:null,
                result:{},
                choose:false,
                currentPage: 1,//默认显示第一页
                pageSize:100,//默认每页显示100条
                totalNum: null,
                search:'',
                Totalsize:null,

            }
        },
    mounted(){        // 页面渲染后触发该区域内容 即页面初始化
            this.getdata("first");
        },
        methods: {
        sortChange: function(column){
            this.currentPage = 1 // return to the first page after sorting
                if (column.prop === 'Project') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                } else if (column.prop === 'Category') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'Name') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'Vendor') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'SourcePriority') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'CompalPN') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'Status') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'VendorPN') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'Description') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'Qty') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'Location') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'DataCodeB') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'ReliabilityB') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'CompatibilityB') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'ResultforB') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'DataCodeC') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'ReliabilityC') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'CompatibilityC') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'ResultforC') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'DataCodeINV') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'ReliabilityINV') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'CompatibilityINV') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'ResultforINV') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'Controlrun') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }else if (column.prop === 'Comments') {
                    this.dataList = this.tableContent.sort(this.sortFun(column.prop, column.order === 'ascending'));
                    console.log(this.dataList);
                }
                    this.showed_data = this.tableContent.slice(0, this.pageSize) // 排序完显示到第一页
                    console.log('Finished');
                    console.log(this.showed_data);

        },
            //排序方法
           sortFun: function(attr, rev) {            //第一个参数传入info里的prop表示排的是哪一列，第二个参数是升还是降排序
           if (rev == undefined) {
               rev = 1;
           } else {
               rev = (rev) ? 1 : -1;
           }
                return function (a, b) {
                    a = a[attr];
                    b = b[attr];
                    if (a < b) {
                        return rev * -1;
                    }
                    if (a > b) {
                        return rev * 1;
                    }
                    return 0;
                }
            },


        handleSizeChange(val) {
        console.log(`每页 ${val} 条`);
                this.pageSize = val;
      },
      handleCurrentChange(val) {
        console.log(`当前页: ${val}`);
          this.currentPage = val;
          console.log(this.tableContent.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize));
      },
            //获取数据
            getdata: function (e) {
                let data = {"isGetData": e, "csrfmiddlewaretoken": $("[name='csrfmiddlewaretoken']").val()};
                axios.post("/MQM/MQM_search/", Qs.stringify(data), {
                    headers: {'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'}
                }).then((res) => {
                    this.tableContent = res.data.content;
                    this.selectItem = res.data.select;
                    this.totalNum=this.tableContent.length;
                });
            },
            indexMethod(index) {
                    return index +1;
            },
            changeCustomer:function () {
                 if(this.$refs.Customer.value ==""){
                      this.selectProject=[""];
                      this.selectCategory=[""];
                      return false;
                 }
                 this.selectProject=this.selectItem[this.$refs.Customer.value];
                 this.selectCategory = this.selectItem[this.$refs.Customer.value];
                 this.selectedProject="";
                this.selectedCategory="";
                 console.log(this.selectProject,this.selectCategory);
             },
            //上传搜索项：以此选项搜索符合条件的内容
             selectMsg :function(){
               let Customer = this.$refs.Customer.value;
               let Project = this.$refs.Project.value;
                let Category = this.$refs.Category.value;

               let data ={"isGetData":"SEARCH","Customer":Customer,"Project":Project,"Category":Category,"csrfmiddlewaretoken":$("[name='csrfmiddlewaretoken']").val()}
               axios.post("/MQM/MQM_search/",Qs.stringify(data), {
               headers:{ 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'}
                }).then((res) => {
                  console.log(res.data.content);
                  this.tableContent=res.data.content.sort(this.sortFun("CompalPN",  'ascending'));//用sort-change方法对分页后台排序时，默认排序列
                  this.selectItem=res.data.select;
                  this.totalNum=this.tableContent.length;
                })
             },
            //導出表格
      exportExcel:function (){
          let temp=[];
         temp.push(Number(this.currentPage));
         temp.push(Number(this.pageSize));
          this.currentPage = 1; //当前页为第一页
          this.pageSize = this.Totalsize; //每页大小限制条数：为总条数（将表格数据全部渲染出来在第一页上）
        this.$nextTick(function () {
               /* 从表生成工作簿对象 */
             let table = document.querySelector("#out-table").cloneNode(true);
             // 因为element-ui的表格的fixed属性导致多出一个table，会下载重复内容，这里删除掉
             table.removeChild(table.querySelector(".el-table__fixed"))
                //let wb = XLSX.utils.table_to_book(table,{raw:true});//mytable为表格的id名

            var wb = XLSX.utils.table_to_book(table,{raw:true});
            /* 获取二进制字符串作为输出 */
            var wbout = XLSX.write(wb, {
                bookType: "xlsx",
                bookSST: true,
                type: "array"
            });
            try {
                saveAs(
                //Blob 对象表示一个不可变、原始数据的类文件对象。
                //Blob 表示的不一定是JavaScript原生格式的数据。
                //File 接口基于Blob，继承了 blob 的功能并将其扩展使其支持用户系统上的文件。
                //返回一个新创建的 Blob 对象，其内容由参数中给定的数组串联组成。
                new Blob([wbout], { type: "application/octet-stream" }),
                //设置导出文件名称
                "sheetjs.xlsx"
                );
            } catch (e) {
                if (typeof console !== "undefined") console.log(e, wbout);
            }
            this.currentPage=temp[0];
            this.pageSize=temp[1];//edwin:要想导出后回到当前页而不是第一页，<el-pagination里面的:page-size="100"，而不能是:page-size="pageSize"
            temp=[];
            return wbout;
            });
        },
      test:function (row) {
          console.log("trt");
      },
            addClass({row, column, rowIndex, columnIndex}) {
                console.log('addcolor',rowIndex, columnIndex)
                if (columnIndex === 7 && (row.ReliabilityB === 'QS'|| row.ReliabilityB === 'Qd_L'|| row.ReliabilityB === 'Qd_C')) {
                    console.log("lie",row)
                        return {
                                  background: '#00FF00'
                                }
                }
                if (columnIndex === 8 && (row.CompatibilityB === 'QS'|| row.CompatibilityB === 'Qd_L'|| row.CompatibilityB === 'Qd_C')) {
                        return {
                                  background: '#00FF00'
                                }
                }
                if (columnIndex === 6 && (row.ResultforB === 'QS'|| row.ResultforB === 'Qd_L'|| row.ResultforB === 'Qd_C')) {
                        return {
                                  background: '#00FF00'
                                }
                }
                if (columnIndex === 11 && (row.ReliabilityC === 'QS'|| row.ReliabilityC === 'Qd_L'|| row.ReliabilityC === 'Qd_C')) {
                        return {
                                  background: '#00FF00'
                                }
                }
                if (columnIndex === 12 && (row.CompatibilityC === 'QS'|| row.CompatibilityC === 'Qd_L'|| row.CompatibilityC === 'Qd_C')) {
                        return {
                                  background: '#00FF00'
                                }
                }
                if (columnIndex === 10 && (row.ResultforC === 'QS'|| row.ResultforC === 'Qd_L'|| row.ResultforC === 'Qd_C')) {
                        return {
                                  background: '#00FF00'
                                }
                }
                if (columnIndex === 15 && (row.ReliabilityINV === 'QS'|| row.ReliabilityINV === 'Qd_L'|| row.ReliabilityINV === 'Qd_C')) {
                        return {
                                  background: '#00FF00'
                                }
                }
                if (columnIndex === 16 && (row.CompatibilityINV === 'QS'|| row.CompatibilityINV === 'Qd_L'|| row.CompatibilityINV === 'Qd_C')) {
                        return {
                                  background: '#00FF00'
                                }
                }
                if (columnIndex === 14 && (row.ResultforINV === 'QS'|| row.ResultforINV === 'Qd_L'|| row.ResultforINV === 'Qd_C')) {
                        return {
                                  background: '#00FF00'
                                }
                }

                if (columnIndex === 7 && row.ReliabilityB === 'QT') {
                        return {
                                  background: '#FFFF00'
                                }
                }
                if (columnIndex === 8 && row.CompatibilityB === 'QT') {
                        return {
                                  background: '#FFFF00'
                                }
                }
                if (columnIndex === 6 && row.ResultforB === 'QT') {
                        return {
                                  background: '#FFFF00'
                                }
                }
                if (columnIndex === 11 && row.ReliabilityC === 'QT') {
                        return {
                                  background: '#FFFF00'
                                }
                }
                if (columnIndex === 12 && row.CompatibilityC === 'QT') {
                        return {
                                  background: '#FFFF00'
                                }
                }
                if (columnIndex === 10 && row.ResultforC === 'QT') {
                        return {
                                  background: '#FFFF00'
                                }
                }
                if (columnIndex === 15 && row.ReliabilityINV === 'QT') {
                        return {
                                  background: '#FFFF00'
                                }
                }
                if (columnIndex === 16 && row.CompatibilityINV === 'QT') {
                        return {
                                  background: '#FFFF00'
                                }
                }
                if (columnIndex === 14 && row.ResultforINV === 'QT') {
                        return {
                                  background: '#FFFF00'
                                }
                }


                if (columnIndex === 7 && (row.ReliabilityB === 'QF'|| row.ReliabilityB === 'DisQ')) {
                        return {
                                  background: '#FF0000'
                                }
                }
                if (columnIndex === 8 && (row.CompatibilityB === 'QF'||row.CompatibilityB === 'DisQ')) {
                        return {
                                  background: '#FF0000'
                                }
                }
                if (columnIndex === 6 && (row.ResultforB === 'QF'|| row.ResultforB === 'DisQ')) {
                        return {
                                  background: '#FF0000'
                                }
                }
                if (columnIndex === 11 && (row.ReliabilityC === 'QF'||row.ReliabilityC === 'DisQ')) {
                        return {
                                  background: '#FF0000'
                                }
                }
                if (columnIndex === 12 && (row.CompatibilityC === 'QF'|| row.CompatibilityC === 'DisQ')) {
                        return {
                                  background: '#FF0000'
                                }
                }
                if (columnIndex === 10 && (row.ResultforC === 'QF'|| row.ResultforC === 'DisQ')) {
                        return {
                                  background: '#FF0000'
                                }
                }
                if (columnIndex === 15 && (row.ReliabilityINV === 'QF'|| row.ReliabilityINV === 'DisQ')) {
                        return {
                                  background: '#FF0000'
                                }
                }
                if (columnIndex === 16 && (row.CompatibilityINV === 'QF'|| row.CompatibilityINV === 'DisQ')) {
                        return {
                                  background: '#FF0000'
                                }
                }
                if (columnIndex === 14 && (row.ResultforINV === 'QF'|| row.ResultforINV === 'DisQ')) {
                        return {
                                  background: '#FF0000'
                                }
                }


                if (columnIndex === 7 && (row.ReliabilityB === 'Drop'|| row.ReliabilityB === 'Not Build')) {
                        return {
                                  background: '#696969'
                                }
                }
                if (columnIndex === 8 && (row.CompatibilityB === 'Drop'|| row.CompatibilityB === 'Not Build')) {
                        return {
                                  background: '#696969'
                                }
                }
                if (columnIndex === 6 && (row.ResultforB === 'Drop'|| row.ResultforB === 'Not Build')) {
                        return {
                                  background: '#696969'
                                }
                }
                if (columnIndex === 11 && (row.ReliabilityC === 'Drop'|| row.ReliabilityC === 'Not Build')) {
                        return {
                                  background: '#696969'
                                }
                }
                if (columnIndex === 12 && (row.CompatibilityC === 'Drop'|| row.CompatibilityC === 'Not Build')) {
                        return {
                                  background: '#696969'
                                }
                }
                if (columnIndex === 10 && (row.ResultforC === 'Drop'|| row.ResultforC === 'Not Build')) {
                        return {
                                  background: '#696969'
                                }
                }
                if (columnIndex === 15 && (row.ReliabilityINV === 'Drop'|| row.ReliabilityINV === 'Not Build')) {
                        return {
                                  background: '#696969'
                                }
                }
                if (columnIndex === 16 && (row.CompatibilityINV === 'Drop'|| row.CompatibilityINV === 'Not Build')) {
                        return {
                                  background: '#696969'
                                }
                }
                if (columnIndex === 14 && (row.ResultforINV === 'Drop'|| row.ResultforINV === 'Not Build')) {
                        return {
                                  background: '#696969'
                                }
                }

                },
            ToBreak (val) {

              if(val){
                  //console.log(val.replace('\n', '<br />'),"val")
                  return val.replace('\n', '<br />')
              }
            },
        },
        computed:{
                datas_computed(){
                    console.log(111)
                    const search=this.search;
                    if(search){
                        return this.tableContent.filter(data=>{
                            return Object.keys(data).some(key=>{
                                return String(data[key]).toLowerCase().indexOf(search.toLowerCase())>-1
                            })
                        })
                    }
                    this.totalNum = this.tableContent.length;
                    return this.tableContent
                },
                total_computed () {
                    this.Totalsize = this.datas_computed.length;//edwin:export数据的个数
                    console.log(this.Totalsize);
                  return this.datas_computed.length
                }
            },
        watch: {
                dataList() {
                    this.showed_data = this.tableContent.slice((this.currentPage - 1) * this.pageSize, this.currentPage * this.pageSize);
                }
            },

})
</script>
{% endblock %}{% endcomment %}
